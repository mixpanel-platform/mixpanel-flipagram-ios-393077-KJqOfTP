<!DOCTYPE html>

<html>
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" type="text/css" href="https://cdn.mxpnl.com/libs/mixpanel-platform/css/reset.css">
        <link rel="stylesheet" type="text/css" href="https://cdn.mxpnl.com/libs/mixpanel-platform/build/mixpanel-platform.v0.latest.min.css">
        <style>
            .mixpanel-platform-body {
              background-color: white;
              color: #747d94;
              font-size: 13px;
            }
            input {
              font-size: 13px;
              color: #747d94;
              height: 20px;
              width: 355px;
              margin: 0 0 20px 0;
              padding: 5px;
              border: 1px solid #bdc7d2;
              -webkit-border-radius: 3px;
              border-radius: 3px;
              position: relative;
              -webkit-appearance: textfield;
              background-color: white;
            }
            input:focus, input:hover {
              outline: 0;
              border-color: #5ba7e1;
            }
            #run {
              clear:both;
              vertical-align: 1px;
              margin-left: 10px;
              padding: 6px 12px;
              background-color: #61adf0;
              background-image: -webkit-linear-gradient(#6ab5f2,#53a0ee);
              background-image: linear-gradient(#6ab5f2,#53a0ee);
              box-shadow: inset 0 1px 1px #77bdf4,0 2px 2px -1px rgba(0,0,0,0.2);
              text-transform: uppercase;
              border: 1px solid #4d93d7;
              color: #fff;
              text-shadow: 0 -1px 0 rgba(0,0,0,0.2);
              border-radius: 3px;
              cursor: pointer;
              font-weight: bold;
              display: inline-block;
            }
            .profile {
              display: none;
            }
            .left_column, .right_column {
              border: 1px solid #bdc7d2;
            }
            .right_column {
              border-left: 0;
            }
        </style>
        <link rel="stylesheet" type="text/css" href="media/css/user.css">
        <link rel="stylesheet" type="text/css" href="media/css/proplist.css">
        <link rel="stylesheet" type="text/css" href="media/css/user_stream.css">


        <script src="https://cdn.mxpnl.com/libs/mixpanel-platform/build/mixpanel-platform.v0.latest.min.js"></script>

        <script src="media/js/date.js"></script>

        <script src="media/js/underscore.js"></script>
        <script src="media/js/underscore.string.js"></script>
        <script src="media/js/underscore.mixins.js"></script>
        <script src="media/js/utility.js"></script>

        <script src="media/js/property_formatter.js"></script>
        <script src="media/js/widgets/widget.js"></script>
        <script src="media/js/widgets/user_stream.js"></script>
        <script src="media/js/widgets/proplist.js"></script>
    </head>
    
    <body class="mixpanel-platform-body">
        <div class="inputs">
          <div class="label">Email Address:</div>
          <input type="text" id="email">
          <input type="submit" id="run" value="run">
        </div>
        <div class="profile">
          <div class="left_column">
              <div class="stream_header">Activity Feed</div>
              <div class="stream_container"></div>
              <div id="no_data_container">
                  <h3>No activity</h3>
                  <p>We have not seen any activity in the past 90 days.</p>
              </div>
          </div>
          <div class="right_column">
              <div class="floating_cell">
                  <div class="user_properties">
                      <table></table>
                  </div>
              </div>
          </div>
        </div>
    

    <script>
        _.namespace("mp.report.globals", function() {
            return {
                utc_offset: -1 * new Date().getTimezoneOffset()
            }
        });

        $('#run').on('click', function() {
          var email = $('#email').val();
  
          /* Validation to check if email is blank. If blank, display "no user record found" */
          if(email.trim() == ""){
            $(".profile").html('<h1 style="text-align: center; padding: 30px 0; font-size: 36px;">No user record found.</h1>');
          }
          else {
            var user = MP.api.people({
                "where": 'properties["$email"] == "' + email + '"'
            }).done(function(results) {
                var results = results.values();
                if (_.isEmpty(results.results)) {
                    $("body").html('<h1 style="text-align: center; padding: 30px 0; font-size: 36px;">No user record found.</h1>');
                } else {
                    var record = results.results[0];
    
                    var property_list = new mp.engage.widgets.PropertyList().create(
                        $(".user_properties table"),
                        {
                            editable: false,
                            initial_values: record.$properties
                        }
                    );
    
                    var user_stream = new mp.engage.widgets.UserStream().create($(".stream_container"));
                    user_stream.set_distinct_ids([record.$distinct_id]);
                }
            });
          }
          
          $('.profile').show();
          
        });
    </script>
    </body>
</html>

